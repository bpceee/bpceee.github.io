<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="preload" as="font" href="/_next/static/media/710e6adf42e8fe6f-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/7b379c56c483b024-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/7b9ca6a1d31c5662-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/931105f8d96e7f26-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/d9957a565b52891d-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/fbdbe464b9e5cc95-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/1060bab20f18b5c2-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/02482d46f001465e.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/ca4b413b104171a1.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/2ec2d810ee62b2fc.css" data-precedence="next"/><link rel="preload" href="/_next/static/chunks/webpack-60e2e3ac064dc981.js" as="script"/><link rel="preload" href="/_next/static/chunks/bce60fc1-ace986fa93a43fca.js" as="script"/><link rel="preload" href="/_next/static/chunks/698-2449c10902a17a12.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-app-98776ef761aa1fbb.js" as="script"/><title>Create Next App</title><meta name="description" content="Generated by create next app"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body style="margin-left:auto;margin-right:auto;max-width:49rem;padding:0px 1.3125rem" class="__className_135483"><nav class="Navbar_navbar__fk_p7"><a href="/"> Home </a><a href="/about"> About </a></nav><main class="Layout_main__luTTh"><article class="Post_blogPost__gpu0n"><header><h1 class="__className_cabfd8">A bizarre pitfall when converting CommonJS to ES6 module</h1><p class="Post_meta__oz6mK">Published <span>30 Jan 2019</span> <!-- -->· tagged with<!-- --> <a class="PostTags_tag__ommYO" href="?tag=webpack">webpack</a></p></header><div class="markdown-body"><html><head></head><body><p dir="auto">Well, it wouldn't be bizarre if you really know inside out of Webpack and ES6 module..</p>
<p dir="auto">As we all know, <a class="user-mention notranslate" data-hovercard-type="organization" data-hovercard-url="/orgs/font-face/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/font-face">@font-face</a> defined in css will trigger a http request for the font file based on the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/filter-function/url" rel="nofollow">url() CSS function</a>. However, after updated to ES6 module, the url somehow doesn't value the <code class="notranslate">__webpack_public_path__</code> set in the entry point <code class="notranslate">app.ts</code>. Thus, many failed font requests.</p>
<p dir="auto">Well, the reason is that import statements are always hoisted in es6 module, so the <code class="notranslate">__webpack_public_path__</code> initialization in the first line of <code class="notranslate">app.ts</code> didn't have any effects in those hoisted import statements including the <code class="notranslate">css</code> file. So, after putting the <code class="notranslate">__webpack_public_path__</code> initialization into a separation file and get it imported into app.ts, problem resolved!</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="// app.ts
import &quot;./public-path&quot;;
import &quot;./index.css&quot;;"><pre class="notranslate"><span class="pl-c">// app.ts</span>
<span class="pl-k">import</span> <span class="pl-s">"./public-path"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s">"./index.css"</span><span class="pl-kos">;</span></pre></div>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="// public-path.ts
__webpack_public_path__ = &quot;...&quot;"><pre class="notranslate"><span class="pl-c">// public-path.ts</span>
<span class="pl-s1">__webpack_public_path__</span> <span class="pl-c1">=</span> <span class="pl-s">"..."</span></pre></div></body></html></div></article></main><footer class="Layout_footer__U3vTh"><hr/><small>© <!-- -->2023<!-- --> Ken Bi. Powered by<!-- --> <a href="https://github.com/bpceee/isblog" rel="noopener noreferrer" target="_blank">isBlog</a></small></footer><script src="/_next/static/chunks/webpack-60e2e3ac064dc981.js" async=""></script><script src="/_next/static/chunks/bce60fc1-ace986fa93a43fca.js" async=""></script><script src="/_next/static/chunks/698-2449c10902a17a12.js" async=""></script><script src="/_next/static/chunks/main-app-98776ef761aa1fbb.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/710e6adf42e8fe6f-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/7b379c56c483b024-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/media/7b9ca6a1d31c5662-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/media/931105f8d96e7f26-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n5:HL[\"/_next/static/media/d9957a565b52891d-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n6:HL[\"/_next/static/media/fbdbe464b9e5cc95-s.p.woff2\",{\"as\":\"font\","])</script><script>self.__next_f.push([1,"\"type\":\"font/woff2\"}]\n7:HL[\"/_next/static/css/02482d46f001465e.css\",{\"as\":\"style\"}]\n0:\"$L8\"\n"])</script><script>self.__next_f.push([1,"9:HL[\"/_next/static/media/1060bab20f18b5c2-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\na:HL[\"/_next/static/css/ca4b413b104171a1.css\",{\"as\":\"style\"}]\nb:HL[\"/_next/static/css/2ec2d810ee62b2fc.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"c:I{\"id\":2353,\"chunks\":[\"272:static/chunks/webpack-60e2e3ac064dc981.js\",\"253:static/chunks/bce60fc1-ace986fa93a43fca.js\",\"698:static/chunks/698-2449c10902a17a12.js\"],\"name\":\"default\",\"async\":false}\ne:I{\"id\":7330,\"chunks\":[\"272:static/chunks/webpack-60e2e3ac064dc981.js\",\"253:static/chunks/bce60fc1-ace986fa93a43fca.js\",\"698:static/chunks/698-2449c10902a17a12.js\"],\"name\":\"\",\"async\":false}\nf:I{\"id\":7095,\"chunks\":[\"95:static/chunks/95-072377135f6d2de2.js\",\"333:static/chunks/app/posts/[slug]/page-33ce5b1ef4dcb760"])</script><script>self.__next_f.push([1,".js\"],\"name\":\"\",\"async\":false}\n11:I{\"id\":9180,\"chunks\":[\"272:static/chunks/webpack-60e2e3ac064dc981.js\",\"253:static/chunks/bce60fc1-ace986fa93a43fca.js\",\"698:static/chunks/698-2449c10902a17a12.js\"],\"name\":\"default\",\"async\":false}\n12:I{\"id\":2306,\"chunks\":[\"272:static/chunks/webpack-60e2e3ac064dc981.js\",\"253:static/chunks/bce60fc1-ace986fa93a43fca.js\",\"698:static/chunks/698-2449c10902a17a12.js\"],\"name\":\"default\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"8:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/02482d46f001465e.css\",\"precedence\":\"next\"}]],[\"$\",\"$Lc\",null,{\"buildId\":\"Iah88G3nAIjLhyehjRczq\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/8\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"8\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"8\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[\"$Ld\",[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]],\"globalErrorComponent\":\"$e\",\"notFound\":[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"style\":{\"marginLeft\":\"auto\",\"marginRight\":\"auto\",\"maxWidth\":\"49rem\",\"padding\":\"0px 1.3125rem\"},\"className\":\"__className_135483\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"Navbar_navbar__fk_p7\",\"children\":[[\"$\",\"$Lf\",null,{\"href\":\"/\",\"children\":\" Home \"}],[\"$\",\"$Lf\",null,{\"href\":\"/about\",\"children\":\" About \"}]]}],[\"$\",\"main\",null,{\"className\":\"Layout_main__luTTh\",\"children\":[\"$L10\",\"$undefined\",[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]]}],[\"$\",\"footer\",null,{\"className\":\"Layout_footer__U3vTh\",\"children\":[[\"$\",\"hr\",null,{}],[\"$\",\"small\",null,{\"children\":[\"© \",2023,\" Ken Bi. Powered by\",\" \",[\"$\",\"a\",null,{\"href\":\"https://github.com/bpceee/isblog\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":\"isBlog\"}]]}]]}]]}]}],\"asNotFound\":false,\"children\":[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"style\":{\"marginLeft\":\"auto\",\"marginRight\":\"auto\",\"maxWidth\":\"49rem\",\"padding\":\"0px 1.3125rem\"},\"className\":\"__className_135483\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"Navbar_navbar__fk_p7\",\"children\":[[\"$\",\"$Lf\",null,{\"href\":\"/\",\"children\":\" Home \"}],[\"$\",\"$Lf\",null,{\"href\":\"/about\",\"children\":\" About \"}]]}],[\"$\",\"main\",null,{\"className\":\"Layout_main__luTTh\",\"children\":[\"$\",\"$L11\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L12\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L11\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L12\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L11\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",[\"slug\",\"8\",\"d\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L12\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$L13\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"8\\\"}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/ca4b413b104171a1.css\",\"precedence\":\"next\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2ec2d810ee62b2fc.css\",\"precedence\":\"next\"}]]}],\"segment\":[\"slug\",\"8\",\"d\"]},\"styles\":[]}],\"segment\":\"posts\"},\"styles\":[]}]}],[\"$\",\"footer\",null,{\"className\":\"Layout_footer__U3vTh\",\"children\":[[\"$\",\"hr\",null,{}],[\"$\",\"small\",null,{\"children\":[\"© \",2023,\" Ken Bi. Powered by\",\" \",[\"$\",\"a\",null,{\"href\":\"https://github.com/bpceee/isblog\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":\"isBlog\"}]]}]]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nd:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Create Next App\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Generated by create next app\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"any\"}]]\n"])</script><script>self.__next_f.push([1,"15:I{\"id\":5282,\"chunks\":[\"95:static/chunks/95-072377135f6d2de2.js\",\"333:static/chunks/app/posts/[slug]/page-33ce5b1ef4dcb760.js\"],\"name\":\"Utterance\",\"async\":false}\n14:T8c0,"])</script><script>self.__next_f.push([1,"\u003chtml\u003e\u003chead\u003e\u003c/head\u003e\u003cbody\u003e\u003cp dir=\"auto\"\u003eWell, it wouldn't be bizarre if you really know inside out of Webpack and ES6 module..\u003c/p\u003e\n\u003cp dir=\"auto\"\u003eAs we all know, \u003ca class=\"user-mention notranslate\" data-hovercard-type=\"organization\" data-hovercard-url=\"/orgs/font-face/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/font-face\"\u003e@font-face\u003c/a\u003e defined in css will trigger a http request for the font file based on the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/filter-function/url\" rel=\"nofollow\"\u003eurl() CSS function\u003c/a\u003e. However, after updated to ES6 module, the url somehow doesn't value the \u003ccode class=\"notranslate\"\u003e__webpack_public_path__\u003c/code\u003e set in the entry point \u003ccode class=\"notranslate\"\u003eapp.ts\u003c/code\u003e. Thus, many failed font requests.\u003c/p\u003e\n\u003cp dir=\"auto\"\u003eWell, the reason is that import statements are always hoisted in es6 module, so the \u003ccode class=\"notranslate\"\u003e__webpack_public_path__\u003c/code\u003e initialization in the first line of \u003ccode class=\"notranslate\"\u003eapp.ts\u003c/code\u003e didn't have any effects in those hoisted import statements including the \u003ccode class=\"notranslate\"\u003ecss\u003c/code\u003e file. So, after putting the \u003ccode class=\"notranslate\"\u003e__webpack_public_path__\u003c/code\u003e initialization into a separation file and get it imported into app.ts, problem resolved!\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"// app.ts\nimport \u0026quot;./public-path\u0026quot;;\nimport \u0026quot;./index.css\u0026quot;;\"\u003e\u003cpre class=\"notranslate\"\u003e\u003cspan class=\"pl-c\"\u003e// app.ts\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\"./public-path\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\"./index.css\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"// public-path.ts\n__webpack_public_path__ = \u0026quot;...\u0026quot;\"\u003e\u003cpre class=\"notranslate\"\u003e\u003cspan class=\"pl-c\"\u003e// public-path.ts\u003c/span\u003e\n\u003cspan class=\"pl-s1\"\u003e__webpack_public_path__\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\"...\"\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/body\u003e\u003c/html\u003e"])</script><script>self.__next_f.push([1,"13:[\"$\",\"article\",null,{\"className\":\"Post_blogPost__gpu0n\",\"children\":[[\"$\",\"header\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"__className_cabfd8\",\"children\":\"A bizarre pitfall when converting CommonJS to ES6 module\"}],[\"$\",\"p\",null,{\"className\":\"Post_meta__oz6mK\",\"children\":[\"Published \",[\"$\",\"span\",null,{\"className\":\"$undefined\",\"children\":\"30 Jan 2019\"}],[\" \",\"· tagged with\",[[\" \",[\"$\",\"$Lf\",\"0\",{\"className\":\"PostTags_tag__ommYO\",\"href\":\"?tag=webpack\",\"children\":\"webpack\"}]]]]]}]]}],[\"$\",\"div\",null,{\"className\":\"markdown-body\",\"dangerouslySetInnerHTML\":{\"__html\":\"$14\"}}],[\"$\",\"$L15\",null,{\"postId\":8}]]}]\n"])</script></body></html>